<!DOCTYPE html>
<html>
  <head>
    <meta content="utf-8" http-equiv="encoding">
    <title>Bahamas Capital</title>
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <style>
        body {
            font: 10px sans-serif;
        }

        .grid .tick {
            stroke: lightgrey;
            opacity: 0.7;
        }

        .grid path {
            stroke-width: 0;
        }

        .axis path, .axis line {
            fill: none;
            stroke: #000;
            shape-rendering: crispEdges;
        }

        .x.axis path {
            display: none;
        }

        .line {
            fill: none;
            stroke: steelblue;
            stroke-width: 1.5px;
        }
    </style>
  </head>
  <body>
    <h1>Notebooks</h1>

    <div id="chart"></div>

    <script>
        var d3 = require("d3");
        var request = require('request');
        request('http://localhost:57859/api/notebook/getoptiondata', function (error, response, body) {
            margin = {
                top: 20,
                right: 20,
                bottom: 20,
                left: 45
            };

            width = 900 - margin.left - margin.right;
            height = 500 - margin.top - margin.bottom;

            var data = JSON.parse(body);

            var x = d3.time.scale()
                .domain(d3.extent(data, function (d) {
                    return new Date(d.date);
                }))
                .rangeRound([0, width]);

            var y = d3.scale.linear()
                .domain([0, 5])
                .range([height, 0]);

            var line = d3.svg.line()
                .x(function (d) {
                    return x(d.date);
                })
                .y(function (d) {
                    return y(d.value);
                });

            var zoom = d3.behavior.zoom()
                .x(x)
                .y(y)
                .on("zoom", zoomed);

            svg = d3.select('#chart')
                .append("svg:svg")
                .attr('width', width + margin.left + margin.right)
                .attr('height', height + margin.top + margin.bottom)
                .call(zoom)
                .append("svg:g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            var make_x_axis = function () {
                return d3.svg.axis()
                    .scale(x)
                    .orient("bottom")
                    .ticks(5);
            };

            var make_y_axis = function () {
                return d3.svg.axis()
                    .scale(y)
                    .orient("left")
                    .ticks(5);
            };

            var xAxis = d3.svg.axis()
                .scale(x)
                .orient("bottom");

            svg.append("svg:g")
                .attr("class", "x axis")
                .attr("transform", "translate(0, " + height + ")")
                .call(xAxis);

            var yAxis = d3.svg.axis()
                .scale(y)
                .orient("left")
                .ticks(5);

            svg.append("g")
                .attr("class", "y axis")
                .call(yAxis);

            svg.append("g")
                .attr("class", "x grid")
                .attr("transform", "translate(0," + height + ")")
                .call(make_x_axis()
                    .tickSize(-height, 0, 0)
                    .tickFormat(""));

            svg.append("g")
                .attr("class", "y grid")
                .call(make_y_axis()
                    .tickSize(-width, 0, 0)
                    .tickFormat(""));

            var clip = svg.append("svg:clipPath")
                .attr("id", "clip")
                .append("svg:rect")
                .attr("x", 0)
                .attr("y", 0)
                .attr("width", width)
                .attr("height", height);

            var chartBody = svg.append("g")
                .attr("clip-path", "url(#clip)");

            chartBody.append("svg:path")
                .datum(data)
                .attr("class", "line")
                .attr("d", line);

            function zoomed() {
                svg.select(".x.axis").call(xAxis);
                svg.select(".y.axis").call(yAxis);
                svg.select(".x.grid")
                    .call(make_x_axis()
                        .tickSize(-height, 0, 0)
                        .tickFormat(""));
                svg.select(".y.grid")
                    .call(make_y_axis()
                        .tickSize(-width, 0, 0)
                        .tickFormat(""));
                svg.select(".line")
                    .attr("class", "line")
                    .attr("d", line);
            }
        });
    </script>
</html>